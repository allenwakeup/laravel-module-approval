(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{ArkM:function(t,e,n){"use strict";n.r(e);n("sMBO"),n("pNMO"),n("4Brf"),n("07d7"),n("0oug"),n("4mDm"),n("PKPk"),n("3bBZ"),n("pjDv"),n("+2oP");var a=n("o0o1"),o=n.n(a),r=(n("x0AG"),n("pDQq"),n("Kz25"),n("mGGf"),n("tkto"),n("5s+n"),n("cCTX")),i=(n("ma9I"),n("rB9j"),n("UxlC"),n("EnZy"),n("FZtP"),n("h/KA")),s=n("5QZp");function c(t,e,n,a,o,r,i,s){this._eventBus=t,this._canvas=e,this._entries=s,this._paletteContainer=i,this._elementFactory=n,this._model=o,this._bpmnFactory=a,this._create=r;var c=this;t.on("tool-manager.update",(function(t){var e=t.tool;c.updateToolHighlight(e)})),t.on("i18n.changed",(function(){c._update()})),t.on("diagram.init",(function(){c._diagramInitialized=!0,c._rebuild()}))}function l(t,e){var n=Object(s.b)(t);(Object(i.l)(e)?e:e.split(/\s+/g)).forEach((function(t){n.add(t)}))}function p(t,e){var n=e.getPaletteEntries();return Object(i.n)(n)?n(t):(Object(i.i)(n,(function(e,n){t[n]=e})),t)}c.$inject=["eventBus","canvas","elementFactory","bpmnFactory","moddle","create","config.paletteContainer","config.paletteEntries"],c.prototype.registerProvider=function(t,e){e||(e=t,t=1e3),this._eventBus.on("palette.getProviders",t,(function(t){t.providers.push(e)})),this._rebuild()},c.prototype.getEntries=function(){return this._getProviders().reduce(p,{})},c.prototype._rebuild=function(){this._diagramInitialized&&(this._getProviders().length&&(this._container||this._init(),this._update()))},c.prototype._init=function(){var t=this,e=this._eventBus,n=this._container=this._paletteContainer;if(n){l(n,"custom-palette");var a=Object(s.i)(".custom-palette-entries",n),o=Object(s.i)(".custom-palette-toggle",n);a||n.appendChild(Object(s.f)('<div class="custom-palette-entries"></div>')),o||n.appendChild(Object(s.f)('<div class="custom-palette-toggle"></div>'))}else n=this._container=Object(s.f)(c.HTML_MARKUP);s.e.bind(n,".custom-palette-toggle, .entry","click",(function(e){var n=e.delegateTarget;if(Object(s.h)(n,".custom-palette-toggle"))return t.toggle();t.trigger("click",e)})),s.g.bind(n,"mousedown",(function(t){t.stopPropagation()})),s.e.bind(n,".entry","dragstart",(function(e){t.trigger("dragstart",e)})),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:n})},c.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(e),e.providers},c.prototype._toggleState=function(t){t=t||{};var e,n=this._getParentContainer(),a=this._container,o=this._eventBus,r=Object(s.b)(a);e="twoColumn"in t?t.twoColumn:this._needsCollapse(n.clientHeight,this._entries||{}),r.toggle("two-column",e),"open"in t&&r.toggle("open",t.open),o.fire("palette.changed",{twoColumn:e,open:this.isOpen()})},c.prototype._update=function(){var t=Object(s.i)(".custom-palette-entries",this._container),e=this._entries=this.getEntries();Object(s.c)(t),Object(i.i)(e,(function(e,n){var a=e.group||"default",o=Object(s.i)("[data-group="+a+"]",t);if(!o){o=Object(s.f)('<div class="group" data-group="'+a+'"></div>');var r=Object(s.f)('<div class="groupLabel"><span title="'.concat(a,'">').concat(a,'</span></i></i><i id="custom-palette-group-arrow" class="').concat("el-icon-arrow-down",'"></i></div></div>'));r.addEventListener("click",(function(){var t=this.querySelector(".el-icon-arrow-down"),e=this.querySelector(".el-icon-arrow-left");if(t){t.classList=["el-icon-arrow-left"];var n=this.parentNode.querySelectorAll(".entry");Object(i.i)(n,(function(t){t.style.display="none"}))}if(e){e.classList=["el-icon-arrow-down"];var a=this.parentNode.querySelectorAll(".entry");Object(i.i)(a,(function(t){t.style.display="block"}))}})),o.appendChild(r),t.appendChild(o)}var c=e.html||(e.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),p=Object(s.f)(c);o.appendChild(p),e.separator||(Object(s.a)(p,"data-action",n),e.title&&Object(s.a)(p,"title",e.title),e.className&&l(p,e.className),e.imageUrl&&p.appendChild(Object(s.f)('<img src="'+e.imageUrl+'">')))})),this.open()},c.prototype.trigger=function(t,e,n){var a,o,r,c=this._entries,l=this._elementFactory,p=this._bpmnFactory,d=this._model,u=this._create,m=e.delegateTarget||e.target;if(!m)return e.preventDefault();(a=c[Object(s.a)(m,"data-action")])&&(o=a.action,r=e.originalEvent||e,Object(i.n)(o)?"click"===t&&o(r,n,l,p,d,u):o[t]&&o[t](r,n,l,p,d,u),e.preventDefault())},c.prototype._layoutChanged=function(){this._toggleState({})},c.prototype._needsCollapse=function(t,e){return t<46*Object.keys(e).length+50},c.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})},c.prototype.open=function(){this._toggleState({open:!0})},c.prototype.toggle=function(t){this.isOpen()?this.close():this.open()},c.prototype.isActiveTool=function(t){return t&&this._activeTool===t},c.prototype.updateToolHighlight=function(t){var e,n;this._toolsContainer||(e=Object(s.i)(".custom-palette-entries",this._container),this._toolsContainer=Object(s.i)("[data-group=tools]",e)),n=this._toolsContainer,Object(i.i)(n.children,(function(e){var n=e.getAttribute("data-action");if(n){var a=Object(s.b)(e);n=n.replace("-tool",""),a.contains("entry")&&n===t?a.add("highlighted-entry"):a.remove("highlighted-entry")}}))},c.prototype.isOpen=function(){return Object(s.b)(this._container).has("open")},c.prototype._getParentContainer=function(){return this._canvas.getContainer()},c.HTML_MARKUP='<div class="custom-palette"><div class="custom-palette-entries"></div><div class="custom-palette-toggle"></div></div>';var d={__init__:["customPalette"],customPalette:["type",c]};function u(t,e,n){this._entries=t,console.log("spaceTool",n),e.registerProvider(this)}u.$inject=["config.paletteEntries","customPalette","spaceTool"],u.prototype.getPaletteEntries=function(t){return this._entries};var m={__depends__:[d],__init__:["customPaletteProvider"],customPaletteProvider:["type",u]},h=n("XkC7"),f=n("W7EE"),g=n("emvA");function b(t,e,n,a,o,r,i){h.a.call(this,t,e,n,a,o,r,1500),this._paletteEntries=i,this._textRenderer=r}b.prototype.canRender=function(t){var e=this._paletteEntries;return Object(i.A)(e,(function(e){return Object(g.b)(t,e.type)}))&&!t.labelTarget},b.prototype.drawShape=function(t,e){var n=this._paletteEntries,a=this._textRenderer,o=Object(i.f)(n,(function(t){return Object(g.b)(e,t.type)}));return o&&o.drawShape instanceof Function?o.drawShape(t,e,a,n):h.a.prototype.drawShape.call(this,t,e)},b.prototype.getShapePath=function(t){return Object(g.b)(t,"bpmn:Task")?Object(f.g)(t,2):h.a.prototype.getShapePath.call(this,t)},b.$inject=["config.bpmnRenderer","eventBus","styles","pathMap","canvas","textRenderer","config.paletteEntries"];var v={__init__:["customRenderer"],customRenderer:["type",b]};function y(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var _=function(){function t(e,n,a,o,r,i,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.bpmnFactory=e,this.create=o,this.elementFactory=r,this.translate=s,!1!==n.autoPlace&&(this.autoPlace=i.get("autoPlace",!1)),a.registerProvider(this)}var e,n,a;return e=t,(n=[{key:"getContextPadEntries",value:function(t){var e=this.autoPlace,n=this.bpmnFactory,a=this.create,o=this.elementFactory,r=this.translate,s={};if("label"===t.type)return s;function c(t){return function(a,r){if(console.log("autoPlace",e),e){var i=n.create("bpmn:Task");i.suitable=t,i.name=r.type;var s=o.createShape({type:"bpmn:Task",businessObject:i});e.append(r,s)}else l(a)}}function l(e){return function(r){var i=n.create("bpmn:Task");i.suitable=e,i.name=t.type;var s=o.createShape({type:"bpmn:Task",businessObject:i});a.start(r,s,t)}}return"bpmn:Task"===t.type&&Object(i.a)(s,{"append.low-task":{group:"model",className:"bpmn-icon-task red",title:r("Append Task with low suitability score"),action:{click:c("#cc0000 "),dragstart:l("#cc0000 ")}},"append.average-task":{group:"model",className:"bpmn-icon-task yellow",title:r("Append Task with average suitability score"),action:{click:c("ffc800"),dragstart:l("ffc800")}},"append.high-task":{group:"model",className:"bpmn-icon-task green",title:r("Append Task with high suitability score"),action:{click:c("#52b415"),dragstart:l("#52b415")}}}),console.log("actions",s),s}}])&&y(e.prototype,n),a&&y(e,a),t}();_.$inject=["bpmnFactory","config","contextPad","create","elementFactory","injector","translate"];var w={__init__:["customContextPad"],customContextPad:["type",_]},x=n("a4vW"),k={"create.customtask":j("etl:Task","自定义","customShape customtask","Create custom Task",(function(t,e,n,a){var o=!e.businessObject.suitable&&"#a2c5fd";e.width=130,e.height=60;var r=S(t,130,60,20,"#4483ec",o),i=n.createText(e.businessObject.name||"",{box:e,align:"center-middle",padding:5,size:{width:100}});return Object(x.a)(t,i),r})),"create.start-StartEvent":j("bpmn:StartEvent","event","custom-icon-start-event-none","Create StartEvent"),"create.end-event":j("bpmn:EndEvent","event","custom-icon-end-event-none","Create EndEvent"),"create.task":j("bpmn:Task","activity","inShape custom-icon-task","Create Task",(function(t,e,n,a){var o=e.businessObject.suitable;e.width=100,e.height=80;var r=S(t,100,80,20,o,"#fff"),i=n.createText(e.businessObject.name||"",{box:e,align:"center-middle",padding:5,size:{width:100}});return Object(x.a)(t,i),r})),"create.exclusive-gateway":j("bpmn:ExclusiveGateway","gateway","inShape custom-icon-gateway-none","Create Gateway"),"create.data-object":j("bpmn:DataObjectReference","data-object","inShape custom-icon-data-object","Create DataObjectReference")};function j(t,e,n,a,o,r,s){var c=t.replace(/^bpmn:/,"");function l(e,n,a,o,r,c){var l=t+ +new Date+"_",p=r.ids.nextPrefixed(l,{type:t}),d=o.create(t,{id:p,name:p}),u=a.createShape(Object(i.a)({type:t},s,{businessObject:d}));s&&(u.businessObject.di.isExpanded=s.isExpanded),c.start(e,u)}return{type:t,group:e,className:n,title:a||r("Create {type}",{type:c}),drawShape:o,action:{dragstart:l,click:l}}}function S(t,e,n,a,o,r){var i=Object(x.f)("rect");return Object(x.b)(i,{width:e,height:n,rx:a,ry:a,stroke:o||"#000",strokeWidth:2,fill:r}),Object(x.a)(t,i),i}var O=n("VQI/"),M=n("XzN5");function E(t){var e,n,a=this.viewbox(!1),o=a.outer,r=a.inner;return r.x>=0&&r.y>=0&&r.x+r.width<=o.width&&r.y+r.height<=o.height&&!t?n={x:0,y:0,width:Math.max(r.width+r.x,o.width),height:Math.max(r.height+r.y,o.height)}:(e=Math.min(1,o.width/r.width,o.height/r.height),n={x:r.x+(t?r.width/2-o.width/e/2:0),y:r.y+(t?r.height/2-o.height/e/2:0),width:o.width/e,height:o.height/e}),this.viewbox(n),this.viewbox(!1).scale}function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e,n,a,o,r,i){try{var s=t[r](i),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(a,o)}function T(t){return function(){var e=this,n=arguments;return new Promise((function(a,o){var r=t.apply(e,n);function i(t){C(r,a,o,i,s,"next",t)}function s(t){C(r,a,o,i,s,"throw",t)}i(void 0)}))}}var $={name:"Bpmn",components:{},props:{height:{type:String,default:"500px"},actions:{required:!0,type:Object,default:function(){return{upload:"",import:""}}}},data:function(){return{bpmnModeler:null,container:null,canvas:null,scale:1,xml:""}},mounted:function(){var t=this;this.$nextTick((function(){t.init()}))},beforeDestroy:function(){},methods:{init:function(){var t=this;return T(o.a.mark((function e(){var n,a,i,s,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t,a=r.a.prototype._modules,i=a.findIndex((function(t){return t.paletteProvider})),a.splice(i,1),s=t.$refs.canvas,c=t.$refs.palette,t.bpmnModeler=new r.a({container:s,paletteContainer:c,paletteEntries:k,keyboard:{bindTo:document},moddleExtensions:{etl:O},additionalModules:[M.a,m,v,w,{}]}),t.initEvent(),t.$isEmpty(t.actions.import)?t.createNewDiagram():t.$get(t.actions.import).then((function(t){"object"===P(t)&&t.code?n.createNewDiagram():n.importXML(t)})),t.bpmnModeler.get("canvas").zoom("fit-viewport","auto"),t.bpmnModeler.get("minimap").open();case 11:case"end":return e.stop()}}),e)})))()},createNewDiagram:function(){return this.xml='<?xml version="1.0" encoding="UTF-8"?>\n<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="sid-38422fae-e03e-43a3-bef4-bd33b32041b2" targetNamespace="http://bpmn.io/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="5.1.2">\n<process id="Process_1" isExecutable="false">\n    <startEvent id="StartEvent_1y45yut" name="开始">\n    <outgoing>SequenceFlow_0h21x7r</outgoing>\n    </startEvent>\n    <task id="Task_1hcentk">\n    <incoming>SequenceFlow_0h21x7r</incoming>\n    </task>\n    <sequenceFlow id="SequenceFlow_0h21x7r" sourceRef="StartEvent_1y45yut" targetRef="Task_1hcentk" />\n</process>\n<bpmndi:BPMNDiagram id="BpmnDiagram_1">\n    <bpmndi:BPMNPlane id="BpmnPlane_1" bpmnElement="Process_1">\n    <bpmndi:BPMNShape id="StartEvent_1y45yut_di" bpmnElement="StartEvent_1y45yut">\n        <omgdc:Bounds x="152" y="102" width="36" height="36" />\n        <bpmndi:BPMNLabel>\n        <omgdc:Bounds x="160" y="145" width="22" height="14" />\n        </bpmndi:BPMNLabel>\n    </bpmndi:BPMNShape>\n    <bpmndi:BPMNShape id="Task_1hcentk_di" bpmnElement="Task_1hcentk">\n        <omgdc:Bounds x="240" y="80" width="100" height="80" />\n    </bpmndi:BPMNShape>\n    <bpmndi:BPMNEdge id="SequenceFlow_0h21x7r_di" bpmnElement="SequenceFlow_0h21x7r">\n        <omgdi:waypoint x="188" y="120" />\n        <omgdi:waypoint x="240" y="120" />\n    </bpmndi:BPMNEdge>\n    </bpmndi:BPMNPlane>\n</bpmndi:BPMNDiagram>\n</definitions>',this.importXML(this.xml)},importXML:function(t){return this.bpmnModeler.importXML(t)},initEvent:function(){this.bpmnModeler.get("eventBus").on("element.click",(function(t){console.log("点击了元素",t)}))},initArrow:function(t){var e=Object(x.f)("marker");Object(x.b)(e,{id:t,viewBox:"0 0 20 20",refX:"11",refY:"10",markerWidth:"10",markerHeight:"10",orient:"auto"});var n=Object(x.f)("path");Object(x.b)(n,{d:"M 1 5 L 11 10 L 1 15 Z",style:" stroke-width: 1px; stroke-linecap: round; stroke-dasharray: 10000, 1; "});var a=Object(s.i)("defs");console.log("defs",a),Object(x.a)(e,n),Object(x.a)(a,e)},saveXML:function(){var t=this;return T(o.a.mark((function e(){var n,a,r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.bpmnModeler.saveXML({format:!0});case 3:n=e.sent,a=n.xml,r=new Blob([a],{type:"application/bpmn20-xml;charset=UTF-8,"}),(i=document.createElement("a")).download="bpmn-".concat(+new Date,".bpmn"),i.innerHTML="Get BPMN SVG",i.href=window.URL.createObjectURL(r),i.onclick=function(t){document.body.removeChild(t.target)},i.style.visibility="hidden",document.body.appendChild(i),i.click(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.log(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})))()},saveSVG:function(){var t=this;return T(o.a.mark((function e(){var n,a,r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.bpmnModeler.saveSVG();case 3:n=e.sent,a=n.svg,r=new Blob([a],{type:"image/svg+xml"}),(i=document.createElement("a")).download="bpmn-".concat(+new Date,".SVG"),i.innerHTML="Get BPMN SVG",i.href=window.URL.createObjectURL(r),i.onclick=function(t){document.body.removeChild(t.target)},i.style.visibility="hidden",document.body.appendChild(i),i.click(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.log(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})))()},uploadXML:function(){var t=this;return T(o.a.mark((function e(){var n,a,r,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.bpmnModeler.saveXML({format:!0});case 3:n=e.sent,a=n.xml,r=new Blob([a],{type:"application/bpmn20-xml;charset=UTF-8,"}),(i=new FormData).append("file",r),t.$postfile(t.actions.upload,i).then((function(e){200===e.code&&(t.$emit("upload",e.data),t.$message.success("保存成功"))})),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(0);case 13:case"end":return e.stop()}}),e,null,[[0,11]])})))()},loadXML:function(){var t=this;return T(o.a.mark((function e(){var n,a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t,a=t.$refs.refFile.files[0],(r=new FileReader).readAsText(a),r.onload=function(){console.log("this",this),n.xmlStr=this.result,n.createNewDiagram()};case 5:case"end":return e.stop()}}),e)})))()},handlerRedo:function(){this.bpmnModeler.get("commandStack").redo()},handlerUndo:function(){this.bpmnModeler.get("commandStack").undo()},handlerZoom:function(t){var e=t?this.scale+t:1;this.bpmnModeler.get("canvas").zoom(e),this.scale=e},getElementAll:function(){var t=this.bpmnModeler.get("elementRegistry").getAll();return console.log("all",t),t},getElementById:function(t){return this.bpmnModeler.get("elementRegistry").get(t)},createBusinessElement:function(){var t=this.bpmnModeler.get("bpmnFactory").create("bpmn:Task",{id:"Task_1",name:"Task"});return this.createElement({type:"bpmn:Task",businessObject:t})},createElement:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"bpmn:Task"},e=this.bpmnModeler.get("elementFactory"),n=e.createShape(t);return n},appendElement:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:400,y:100},a=this.bpmnModeler.get("modeling");a.createShape(e,n,t)},connectElement:function(t,e){this.bpmnModeler.get("modeling").connect(t,e)},appendConnect:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:400,y:100},a=arguments.length>3?arguments[3]:void 0,o=this.bpmnModeler.get("modeling");o.appendShape(t,e,n,a)},getEventBusAll:function(){var t=this.bpmnModeler.get("eventBus"),e=Object.keys(t._listeners);return console.log(e),e},updateAttr:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getElementById(t),a=this.bpmnModeler.get("modeling");a.updateProperties(n,e)},resizeListener:function(){var t=this.bpmnModeler.get("canvas");E.call(t,!0)}}},B=(n("hPCV"),n("KHd+")),A=Object(B.a)($,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bpmn",style:{height:this.height}},[e("div",{staticClass:"tool"},[e("a-button",{on:{click:this.uploadXML}},[this._v("保存")]),this._v(" "),e("a-input",{ref:"refFile",staticStyle:{display:"none"},attrs:{type:"file",id:"files"},on:{change:this.loadXML}})],1),this._v(" "),e("div",{ref:"palette"}),this._v(" "),e("div",{ref:"canvas",staticClass:"canvas"})])}),[],!1,null,"d5bbe868",null).exports;n("yq1k"),n("JTJg");function N(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return L(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,o=function(){};return{s:o,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,r=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw r}}}}function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function D(t,e,n,a,o,r,i){try{var s=t[r](i),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(a,o)}var F={globName:"AModal",mixins:[n("TnLG").Modal],props:{draggable:{type:Boolean,default:!0},centered:{type:Boolean,default:!0},cancelText:{type:String,default:"关闭"},okText:{type:String,default:"保存"}},watch:{visible:{handler:function(t){var e,n=this;return(e=o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.$nextTick(),setTimeout((function(){n.handleModalDrag(t)}),30);case 2:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(a,o){var r=e.apply(t,n);function i(t){D(r,a,o,i,s,"next",t)}function s(t){D(r,a,o,i,s,"throw",t)}i(void 0)}))})()}}},methods:{handleModalDrag:function(t){if(t){var e,n=N(document.querySelectorAll(".ant-modal-wrap"));try{for(n.s();!(e=n.n()).done;){var a=e.value,o=this.getStyle(a,"display"),r=a.getAttribute("data-drag");"none"!==o&&null===r&&this.drag(a)}}catch(t){n.e(t)}finally{n.f()}}},getStyle:function(t,e){return window.document.currentStyle?t.currentStyle[e]:getComputedStyle(t,!1)[e]},drag:function(t){var e=this;if(t){t.setAttribute("data-drag",this.draggable);var n=t.querySelector(".ant-modal-header"),a=t.querySelector(".ant-modal");n&&a&&this.draggable&&(n.style.cursor="move",n.onmousedown=function(t){var n=t.clientX,o=t.clientY,r=document.body.clientWidth,i=document.documentElement.clientHeight,s=a.offsetWidth,c=a.offsetHeight,l=a.offsetLeft,p=r-a.offsetLeft-s,d=a.offsetTop,u=i-a.offsetTop-c,m=e.getStyle(a,"left"),h=e.getStyle(a,"top"),f=m,g=h;m.includes("%")?(f=+document.body.clientWidth*(+m.replace(/%/g,"")/100),g=+document.body.clientHeight*(+h.replace(/%/g,"")/100)):(f=+m.replace(/px/g,""),g=+h.replace(/px/g,"")),document.onmousemove=function(t){var e=t.clientX-n,r=t.clientY-o;-e>l?e=-l:e>p&&(e=p),-r>d?r=-d:r>u&&(r=u),a.style.cssText+=";left:".concat(e+f,"px;top:").concat(r+g,"px;")},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null}})}}}},R={name:"ABpmnInput",components:{ABpmnDesigner:A,ADraggableModal:Object(B.a)(F,void 0,void 0,!1,null,null,null).exports},props:{file:{required:!0,type:String,default:""},actions:{required:!0,type:Object,default:function(){return{upload:"",import:""}}},title:{type:String,default:"设计器"}},computed:{},data:function(){return{show:!1}},methods:{toggle:function(){this.show=!this.show},onUpload:function(t){this.$emit("change",t)},close:function(){this.show=!1}},created:function(){},mounted:function(){}};function I(t){return function(t){if(Array.isArray(t))return q(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var X={components:{ABpmnInput:Object(B.a)(R,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a-input",{attrs:{disabled:""},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}},[n("a-icon",{attrs:{slot:"addonAfter",type:"edit"},on:{click:t.toggle},slot:"addonAfter"})],1),t._v(" "),n("a-draggable-modal",{attrs:{draggable:!0,title:t.title,"body-style":{padding:0,height:"800px"},"dialog-style":{top:0,left:0},visible:t.show,cancelText:"关闭",width:"80%",footer:null,height:"800px"},on:{cancel:t.close}},[n("a-layout-content",[n("a-bpmn-designer",{attrs:{height:"800px",actions:t.actions},on:{upload:t.onUpload}})],1)],1)],1)}),[],!1,null,"68146a09",null).exports},props:{},data:function(){return{form:{pid:0,code:"",name:"",alias:"",category_id:0,group:"",bpmn_file:"",type:0,order:1,status:1},rules:{code:[{min:1,max:20,message:"1到20个字符",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:2,max:10,message:"至少两个字",trigger:"blur"}]},categories:[],templates:[],id:0}},watch:{},computed:{},methods:{handleSubmit:function(){var t=this;if(this.$isEmpty(this.form.code))return this.$message.error("编码不能为空");if(this.$isEmpty(this.form.name))return this.$message.error("名称不能为空");var e=this.$apiHandle(this.$api.moduleApprovalTemplates,this.id);e.status?this.$put(e.url,this.form).then((function(e){return 200===e.code?(t.$message.success(e.msg),t.$router.back()):t.$message.error(e.msg)})):this.$post(e.url,this.form).then((function(e){return 200===e.code||201===e.code?(t.$message.success(e.msg),t.$router.back()):t.$message.error(e.msg)}))},get_form:function(){var t=this;this.$get(this.$api.moduleApprovalTemplates+"/"+this.id).then((function(e){t.form=e.data}))},onChangeOrder:function(t){this.form.order=t},onChangeStatus:function(t){this.form.status=t?1:0},onChangeBpmnPath:function(t){console.log(t),this.form.bpmn_file=t.path},template_change:function(t,e){this.form.pid=t[t.length-1],0===t.length&&(this.form.pid=0)},categorie_change:function(t,e){this.form.category_id=t[t.length-1],0===t.length&&(this.form.category_id=0)},load_templates:function(t){var e=this,n=t[t.length-1];n.loading=!0;var a={pid:n.id,data_type:"select"};this.$get(this.$api.moduleApprovalTemplates,a).then((function(t){n.loading=!1,n.children=t.data,e.templates=I(e.templates)}))},load_categories:function(t){var e=this,n=t[t.length-1];n.loading=!0;var a={pid:n.id,data_type:"select"};this.$get(this.$api.moduleApprovalCategories,a).then((function(t){n.loading=!1,n.children=t.data,e.categories=I(e.categories)}))},onload:function(){var t=this;this.$isEmpty(this.$route.params.id)||(this.id=this.$route.params.id,this.get_form()),this.$get(this.$api.moduleApprovalCategories,{data_type:"select"}).then((function(e){200===e.code&&(t.categories=e.data)})),this.$get(this.$api.moduleApprovalTemplates,{data_type:"select"}).then((function(e){200===e.code&&(t.templates=e.data)}))}},created:function(){this.onload()},mounted:function(){}},U=Object(B.a)(X,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"admin_table_page_title"},[n("a-button",{staticClass:"float_right",attrs:{icon:"arrow-left"},on:{click:function(e){return t.$router.back()}}},[t._v("返回")]),t._v("\n        模版编辑\n    ")],1),t._v(" "),n("div",{staticClass:"unline underm"}),t._v(" "),n("div",{staticClass:"admin_form"},[n("a-form-model",{attrs:{model:t.form,rules:t.rules,"label-col":{span:6},"wrapper-col":{span:16}}},[n("a-row",{attrs:{gutter:1}},[n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"模版分类"}},[n("a-cascader",{attrs:{"load-data":t.load_categories,options:t.categories,fieldNames:{label:"name",value:"id",children:"children"},placeholder:t.form.category_id>0&&t.form.categories?t.form.categories.join(" / "):"请选择模版分类","change-on-select":""},on:{change:t.categorie_change}})],1)],1)],1),t._v(" "),n("a-row",{attrs:{gutter:1}},[n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"上一级"}},[n("a-cascader",{attrs:{"load-data":t.load_templates,options:t.templates,fieldNames:{label:"name",value:"id",children:"children"},placeholder:t.form.pid>0&&t.form.path_text?t.form.path_text.join(" / "):"请选择上一级","change-on-select":""},on:{change:t.template_change}})],1)],1),t._v(" "),n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"状态"}},[n("a-switch",{attrs:{"checked-children":"启用","un-checked-children":"禁用",checked:1===t.form.status},on:{change:t.onChangeStatus}})],1)],1)],1),t._v(" "),n("a-row",{attrs:{gutter:1}},[n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"编码",prop:"code"}},[n("a-input",{model:{value:t.form.code,callback:function(e){t.$set(t.form,"code",e)},expression:"form.code"}})],1)],1),t._v(" "),n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"名称",prop:"name"}},[n("a-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1)],1),t._v(" "),n("a-row",{attrs:{gutter:1}},[n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"别名",prop:"alias"}},[n("a-input",{model:{value:t.form.alias,callback:function(e){t.$set(t.form,"alias",e)},expression:"form.alias"}})],1)],1),t._v(" "),t.id>0?n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"BPMN",prop:"bpmn"}},[n("a-bpmn-input",{attrs:{file:t.form.bpmn_file||"",actions:{upload:t.$api.moduleApprovalTemplates+"/upload/"+t.id,import:t.$api.moduleApprovalTemplates+"/download/"+t.id},title:(t.form.path_text?t.form.path_text.join(" / "):"")+t.form.name+"流程设计器"},on:{change:t.onChangeBpmnPath}})],1)],1):t._e()],1),t._v(" "),n("a-row",{attrs:{gutter:1}},[n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"类型"}},[n("a-radio-group",{attrs:{name:"radioGroup","default-value":0},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[n("a-radio",{attrs:{value:0}},[t._v("默认")]),t._v(" "),n("a-radio",{attrs:{value:1}},[t._v("其他")])],1)],1)],1),t._v(" "),n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"分组",prop:"group"}},[n("a-input",{model:{value:t.form.group,callback:function(e){t.$set(t.form,"group",e)},expression:"form.group"}})],1)],1)],1),t._v(" "),n("a-row",{attrs:{gutter:1}},[n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"描述",prop:"description"}},[n("a-textarea",{attrs:{"auto-size":{minRows:3,maxRows:5}},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1)],1),t._v(" "),n("a-row",{attrs:{gutter:1}},[n("a-col",{attrs:{span:12}},[n("a-form-model-item",{attrs:{label:"排序",prop:"order"}},[n("a-input-number",{attrs:{min:0},on:{change:t.onChangeOrder},model:{value:t.form.order,callback:function(e){t.$set(t.form,"order",e)},expression:"form.order"}})],1)],1)],1),t._v(" "),n("a-form-model-item",{attrs:{"wrapper-col":{span:12,offset:5}}},[n("a-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("提交")])],1)],1)],1)])}),[],!1,null,"092b5bd1",null);e.default=U.exports},"VQI/":function(t){t.exports=JSON.parse('{"name":"etl","uri":"http://etl.org/bpmn","prefix":"etl","xml":{"tagAlias":"lowerCase"},"associations":[],"types":[{"name":"Task","superClass":["bpmn:UserTask"],"properties":[]}],"emumerations":[]}')},ZtvG:function(t,e,n){(t.exports=n("I1BE")(!1)).push([t.i,".bpmn[data-v-d5bbe868]{width:100%;position:relative}.bpmn .canvas[data-v-d5bbe868]{width:100%;height:100%}.bpmn .panel[data-v-d5bbe868]{position:absolute;right:0;top:0;width:300px}.bpmn .tool[data-v-d5bbe868]{position:absolute;z-index:1;left:30%;top:0;transform:translateX(-50%)}",""])},hPCV:function(t,e,n){"use strict";n("nyEZ")},nyEZ:function(t,e,n){var a=n("ZtvG");"string"==typeof a&&(a=[[t.i,a,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n("aET+")(a,o);a.locals&&(t.exports=a.locals)}}]);